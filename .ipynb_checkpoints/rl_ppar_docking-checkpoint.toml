# REINVENT4 Reinforcement Learning с DockStream + Vina
run_type = "staged_learning"
device = "cpu"                    # CPU режим (нет GPU)
tb_logdir = "tb_logs"
json_out_config = "run_config.json"

[parameters]
prior_file = "reinvent.prior"       # Скачать с Zenodo (см. ниже)
agent_file = "reinvent.prior"
summary_csv_prefix = "results/ppar_rl"
batch_size = 32
use_checkpoint = false
purge_memories = false

[learning_strategy]
type = "dap"
sigma = 128
rate = 0.0001

[diversity_filter]
type = "IdenticalMurckoScaffold"
bucket_size = 25
minscore = 0.4
minsimilarity = 0.4
penalty_multiplier = 0.5

[[stage]]
max_score = 1.0
max_steps = 100
chkpt_file = "results/stage1.chkpt"

[stage.scoring]
type = "geometric_mean"

# ─── Компонент 1: Docking score (DockStream + Vina) ──────────────────────────
[[stage.scoring.component]]
[[stage.scoring.component.DockStream.endpoint]]
name = "PPARa Vina Score"
weight = 0.8

params.configuration_path = "dockstream_config.json"
params.docker_script_path = "/home/michael-kaiser/DockStream/docker.py"
params.docker_python_path = "/home/michael-kaiser/anaconda3/envs/DockStream/bin/python"

transform.type = "reverse_sigmoid"  # Минимизировать docking score!
transform.high = -6.0               # Хороший порог (kcal/mol)
transform.low = -12.0               # Отличный порог
transform.k = 0.25

# ─── Компонент 2: QED ─────────────────────────────────────────────────────────
[[stage.scoring.component]]
[[stage.scoring.component.QED.endpoint]]
name = "Drug-likeness"
weight = 0.1

# ─── Компонент 3: Структурные алерты ─────────────────────────────────────────
[[stage.scoring.component]]
[stage.scoring.component.custom_alerts]
[[stage.scoring.component.custom_alerts.endpoint]]
name = "Structural Alerts"
weight = 1.0
params.smarts = [
    "[*;r8]", "[*;r9]", "[*;r10]",
    "[#8][#8]", "[#6;+]", "[#16][#16]",
    "C#C", "C(=[O,S])[O,S]"
]

# ─── Компонент 4: MW (drug-like) ──────────────────────────────────────────────
[[stage.scoring.component]]
[[stage.scoring.component.MolecularWeight.endpoint]]
name = "MW"
weight = 0.1
transform.type = "double_sigmoid"
transform.high = 500.0
transform.low = 200.0
transform.coef_div = 500.0
transform.coef_si = 20.0
transform.coef_se = 20.0
